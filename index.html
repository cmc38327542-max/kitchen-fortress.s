<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title> ì£¼ë°© í¬íŠ¸ë¦¬ìŠ¤ : ì•ˆì¡±ë°œ vs ì—´ì”¸ì•„êµ¬ </title>
  <style>
    :root{
      --bg1:#050812; --bg2:#0b1220;
      --card:rgba(17,24,39,.74);
      --border:rgba(255,255,255,.10);
      --text:#e5e7eb; --muted:#94a3b8;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Arial,sans-serif;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      color:var(--text);
    }
    .wrap{max-width:980px;margin:0 auto;padding:14px;}
    h1{margin:8px 0 4px;font-size:22px}
    .sub{margin:0 0 12px;color:var(--muted);font-size:13px;line-height:1.45}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      box-shadow:0 10px 30px rgba(0,0,0,.28);
    }
    canvas{
      width:100%; height:auto; display:block;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(900px 420px at 50% 100%, rgba(34,197,94,.14), transparent 60%),
        linear-gradient(180deg, rgba(2,6,23,.08), rgba(2,6,23,.82));
      /* ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤/ì¤Œ ë°©ì§€ */
      touch-action:none;
      user-select:none;
    }
    .hud{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .pill{
      display:flex;gap:10px;align-items:center;flex-wrap:wrap;
      padding:8px 10px;border-radius:999px;
      background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.10);
      font-size:13px;
    }
    button{
      cursor:pointer;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(17,24,39,.7);
      color:var(--text);
      padding:8px 10px;border-radius:10px;
      font-weight:900;
    }
    button:hover{filter:brightness(1.12)}
    button.primary{background:rgba(34,197,94,.26);border-color:rgba(34,197,94,.55)}
    button.warn{background:rgba(245,158,11,.18);border-color:rgba(245,158,11,.45)}
    .hint{color:var(--muted);font-size:13px;line-height:1.55}
    .small{color:var(--muted);font-size:12px;margin-top:10px}
    .tag{
      font-size:12px;padding:4px 8px;border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color:var(--muted);
      display:inline-block
    }
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ì£¼ë°© í¬íŠ¸ë¦¬ìŠ¤ ğŸ¥˜ğŸ’¥  ê³¨ë ˜ìŠ¤í†¤ ì„œì¸ì¬ vs ë§ˆì™•ëš±ë³´ ì•ˆì¡±ë°œ</h1>
  <p class="sub">
    <b>ì„ ê³µ ì„ íƒí˜•</b> í¬íŠ¸ë¦¬ìŠ¤. ë‚´ í„´ì¼ ë•Œë§Œ <b>ë“œë˜ê·¸â†’ë†“ê¸°</b>ë¡œ ë°œì‚¬.<br/>
    í„´ë§ˆë‹¤ <b>ë°”ëŒ(WIND)</b>ì´ ë°”ë€ë‹¤. (PC/í° ë‘˜ ë‹¤ ì¡°ì‘ ê°€ëŠ¥)
  </p>

  <div class="row">
    <div class="card" style="flex:1 1 640px;">
      <div class="hud">
        <div class="pill">
          <span>ğŸŒ€ WIND: <b id="wind">0</b></span>
          <span>ğŸ¯ í„´: <b id="turn">-</b></span>
          <span>â±ï¸ í„´ì‹œê°„: <b id="timer">--</b></span>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button id="startSeo" class="primary">ì„œì¸ì¬ ì„ ê³µ</button>
          <button id="startJokbal" class="warn">ì•ˆì¡±ë°œ ì„ ê³µ</button>
          <button id="resetBtn">ë¦¬ì…‹</button>
        </div>
      </div>

      <div style="margin-top:10px;">
        <canvas id="c" width="900" height="520"></canvas>
      </div>

      <div class="small" id="msg">ğŸ’¬ ì„ ê³µ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•´!</div>
      <div class="small mono" id="err" style="display:none;color:#fca5a5;"></div>
    </div>

    <div class="card" style="flex:1 1 300px;">
      <div class="tag">ìºë¦­í„°/ë¬´ê¸°</div>
      <div class="hint" style="margin-top:10px;">
        <b>ì„œì¸ì¬(ê³¨ë ˜ìŠ¤í†¤)</b> : ë¬´í‘œì •, ëŠë¦¿í•˜ê³  ë‹¨ë‹¨í•œ ëŠë‚Œ<br/>
        ëŒ€ì‚¬: <b>â€œì¸ìƒë§í•´ë¼!â€</b><br/>
        ë¬´ê¸°: <b>ìƒì•„êµ¬ ë¯¸ì‚¬ì¼</b> (ê°€ë³ê³  íƒ„ë„ ë†’ìŒ)<br/><br/>
        <b>ì•ˆì¡±ë°œ(ë§ˆì™•ëš±ë³´)</b> : ëŒ€ë¨¸ë¦¬+ì•ˆê²½, ëš±ëš±í•œ ë§ˆì™• í¬ìŠ¤<br/>
        ëŒ€ì‚¬: <b>â€œê·¸ë§Œì¢€ê´´ë¡­í˜€!â€</b><br/>
        ë¬´ê¸°: <b>ì•ˆì¡±ë°œ ì•ë‹¤ë¦¬ ë¯¸ì‚¬ì¼</b> (ë¬´ê²ê³  íƒ„ë„ ë‚®ìŒ)
      </div>

      <div class="card" style="margin-top:12px;background:rgba(17,24,39,.55);">
        <div class="hint">
          <b>ì¡°ì‘</b><br/>
          ë‚´ í„´ì¼ ë•Œ ìºë¦­í„° â€œì† ê·¼ì²˜â€ íƒ„ì„ ì¡ê³  ë“œë˜ê·¸ â†’ ë†“ê¸°<br/>
          ë“œë˜ê·¸ ê¸¸ì´ = í˜ / ë°©í–¥ = ë°œì‚¬ ë°©í–¥
        </div>
      </div>

      <div class="card" style="margin-top:12px;background:rgba(17,24,39,.55);">
        <div class="hint">
          <b>íŒ</b><br/>
          ë°”ëŒì´ ê°•í•˜ë©´ íƒ„ì´ ì˜†ìœ¼ë¡œ í¬ê²Œ íœœë‹¤.<br/>
          ë„ˆë¬´ ì„¸ë©´ â€œë„˜ê²¨ë§ì¶”ê¸°â€ ëœë‹¤.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');

  const windEl = document.getElementById('wind');
  const turnEl = document.getElementById('turn');
  const timerEl = document.getElementById('timer');
  const msgEl = document.getElementById('msg');
  const errEl = document.getElementById('err');

  const startSeo = document.getElementById('startSeo');
  const startJokbal = document.getElementById('startJokbal');
  const resetBtn = document.getElementById('resetBtn');

  // ì—ëŸ¬ê°€ ë‚˜ë©´ í™”ë©´ì— í‘œì‹œ(â€œê²Œì„ í™”ë©´ ì•ˆ ëœ¸â€ ë¬¸ì œë¥¼ ì¦‰ì‹œ ì¡ê¸° ìœ„í•¨)
  window.addEventListener('error', (e) => {
    errEl.style.display = 'block';
    errEl.textContent = "JS ERROR: " + (e.message || e.error || "unknown");
  });

  // ===== Physics =====
  const G = 1200;
  const BASE_WIND = 140; // -140 ~ +140
  const REST = 0.55;
  const FRICTION = 0.985;

  // ===== Field =====
  const GROUND_Y = 450;
  const LEFT = 30, RIGHT = canvas.width - 30;

  // ===== Turn =====
  const TURN_LIMIT = 20; // seconds
  let running = false;
  let last = performance.now();
  let turn = 0;               // 0: ì„œì¸ì¬, 1: ì•ˆì¡±ë°œ
  let wind = 0;
  let turnTimeLeft = TURN_LIMIT;

  let shotInAir = false;         // íƒ„ì´ ë‚ ì•„ê°€ëŠ” ë™ì•ˆ ì…ë ¥ ê¸ˆì§€
  let turnTransitioning = false; // í„´ ì „í™˜ ì¤‘ë³µ ë°©ì§€

  // ===== Characters =====
  const players = [
    {
      id: 'seo',
      name: 'ì„œì¸ì¬',
      x: 160, y: GROUND_Y,
      hp: 100,
      body: { w: 54, h: 138 },     // ê³¨ë ˜ìŠ¤í†¤: ê¸¸ì­‰/ë‹¨ë‹¨
      head: { r: 18 },
      projectile: { kind:'agu', r: 14, air: 0.992, bounce: 0.72, powerMul: 1.00, arcMul: 1.10, dmg: 26 },
      taunt: 'ì¸ìƒë§í•´ë¼!'
    },
    {
      id: 'jokbal',
      name: 'ì•ˆì¡±ë°œ',
      x: 740, y: GROUND_Y,
      hp: 100,
      body: { w: 92, h: 96 },      // ë§ˆì™•ëš±ë³´: ë„“ê³  ë¬µì§
      head: { r: 22 },
      projectile: { kind:'jokbal', r: 18, air: 0.995, bounce: 0.45, powerMul: 1.12, arcMul: 0.92, dmg: 30 },
      taunt: 'ê·¸ë§Œì¢€ê´´ë¡­í˜€!'
    }
  ];

  // ===== Shots =====
  let shots = [];

  class Shot {
    constructor(ownerIndex, x, y, vx, vy) {
      const p = players[ownerIndex];
      const pr = p.projectile;
      this.owner = ownerIndex;
      this.kind = pr.kind;
      this.r = pr.r;
      this.air = pr.air;
      this.bounce = pr.bounce;
      this.dmg = pr.dmg;
      this.x = x; this.y = y;
      this.vx = vx; this.vy = vy;
      this.dead = false;
      this.hit = false;
      this.createdAt = performance.now();
    }

    update(dt) {
      this.vx *= this.air;
      this.vy *= this.air;

      this.vy += G * dt;
      this.vx += wind * dt;

      this.x += this.vx * dt;
      this.y += this.vy * dt;

      // wall bounce
      if (this.x - this.r < LEFT) { this.x = LEFT + this.r; this.vx = -this.vx * REST; }
      if (this.x + this.r > RIGHT){ this.x = RIGHT - this.r; this.vx = -this.vx * REST; }

      // ground bounce
      if (this.y + this.r > GROUND_Y) {
        this.y = GROUND_Y - this.r;
        this.vy = -this.vy * this.bounce;
        this.vx *= FRICTION;
        if (Math.abs(this.vy) < 45) this.vy = 0;
      }

      // hit enemy
      const enemy = players[1 - this.owner];
      if (!this.hit && circleHitsPlayer(this, enemy)) {
        this.hit = true;
        applyDamage(1 - this.owner, this.dmg, this.vx);
        this.dead = true;
        endTurn(`${players[this.owner].name} ì ì¤‘! -${this.dmg} HP`);
        return;
      }

      // timeout -> miss
      if (performance.now() - this.createdAt > 5500) {
        this.dead = true;
        endTurn(`${players[this.owner].name} ê³µê²© ë¹—ë‚˜ê°â€¦`);
      }
    }

    draw() {
      ctx.save();
      ctx.translate(this.x, this.y);

      if (this.kind === 'jokbal') {
        // ë§ˆì™•ì¡±ë°œ ì•ë‹¤ë¦¬ ëŠë‚Œ: ë‘¥ê·¼ ê³ ê¸° + ë¼ˆ
        ctx.beginPath();
        ctx.arc(0, 0, this.r, 0, Math.PI * 2);
        ctx.fillStyle = "rgba(236,179,95,0.96)";
        ctx.fill();
        ctx.strokeStyle = "rgba(255,255,255,0.90)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(-6, -2);
        ctx.lineTo(10, 7);
        ctx.stroke();

        // ë§ˆì™• ì˜¤ë¼(ì‚´ì§)
        ctx.strokeStyle = "rgba(245,158,11,0.35)";
        ctx.lineWidth = 6;
        ctx.beginPath();
        ctx.arc(0, 0, this.r + 6, 0, Math.PI * 2);
        ctx.stroke();
      } else {
        // ìƒì•„êµ¬: í‘¸ë¥¸ ìƒì„  + ê¼¬ë¦¬
        ctx.beginPath();
        ctx.arc(0, 0, this.r, 0, Math.PI * 2);
        ctx.fillStyle = "rgba(147,197,253,0.96)";
        ctx.fill();

        ctx.fillStyle = "rgba(2,6,23,0.75)";
        ctx.beginPath();
        ctx.arc(4, -3, 2.2, 0, Math.PI * 2);
        ctx.fill();

        ctx.strokeStyle = "rgba(2,6,23,0.32)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(-this.r, 0);
        ctx.lineTo(-this.r - 8, -6);
        ctx.moveTo(-this.r, 0);
        ctx.lineTo(-this.r - 8, 6);
        ctx.stroke();
      }

      ctx.restore();
    }
  }

  function circleHitsPlayer(shot, pl) {
    // í”Œë ˆì´ì–´ ëª¸í†µì„ íƒ€ì›ìœ¼ë¡œ íŒì • (ë„‰ë„‰í•˜ê²Œ)
    const cx = pl.x;
    const cy = pl.y - pl.body.h * 0.56;
    const rx = pl.body.w * 0.60;
    const ry = pl.body.h * 0.60;

    const dx = shot.x - cx;
    const dy = shot.y - cy;
    const v = (dx*dx)/(rx*rx) + (dy*dy)/(ry*ry);
    return v <= 1.0 + (shot.r / 85);
  }

  function applyDamage(playerIndex, dmg, hitVx) {
    const pl = players[playerIndex];
    pl.hp = Math.max(0, pl.hp - dmg);

    // knockback
    const knock = Math.max(-70, Math.min(70, hitVx * 0.012));
    pl.x += knock;
    pl.x = Math.max(90, Math.min(canvas.width - 90, pl.x));

    if (pl.hp <= 0) {
      running = false;
      shotInAir = false;
      turnTransitioning = false;
      toast(`ğŸ† ${players[1-playerIndex].name} ìŠ¹ë¦¬! (â€œ${players[1-playerIndex].taunt}â€)`);
    }
  }

  // ===== Turn logic =====
  function setWind() {
    wind = (Math.random() * 2 - 1) * BASE_WIND;
    windEl.textContent = wind.toFixed(0);
  }

  function setTurnUI() {
    turnEl.textContent = players[turn].name;
  }

  function beginTurn() {
    if (!running) return;
    setWind();
    setTurnUI();
    turnTimeLeft = TURN_LIMIT;
    shotInAir = false;
    toast(`ğŸ¯ ${players[turn].name} í„´! â€œ${players[turn].taunt}â€`);
  }

  function endTurn(reason) {
    if (!running) return;
    if (turnTransitioning) return;

    turnTransitioning = true;
    shotInAir = false;

    setTimeout(() => {
      shots = [];
      turn = 1 - turn;
      turnTransitioning = false;
      beginTurn();
      toast(reason);
    }, 550);
  }

  // ===== Input (PC + Mobile í†µí•©: Pointer Events) =====
  let dragging = false;
  let dragStart = null;
  let dragNow = null;

  function getPointerPos(e) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    return {
      x: (e.clientX - rect.left) * scaleX,
      y: (e.clientY - rect.top) * scaleY
    };
  }

  function spawnPosFor(pl) {
    const dir = (pl.id === 'seo') ? 1 : -1;
    return { x: pl.x + dir * (pl.body.w * 0.62), y: pl.y - pl.body.h * 0.72 };
  }

  function canGrabAmmo(m, ownerIndex) {
    const pl = players[ownerIndex];
    const sp = spawnPosFor(pl);
    const r = pl.projectile.r + 20;
    return Math.hypot(m.x - sp.x, m.y - sp.y) <= r;
  }

  function fireShotFromDrag() {
    const shooter = players[turn];
    const sp = spawnPosFor(shooter);

    const dx = dragNow.x - dragStart.x;
    const dy = dragNow.y - dragStart.y;

    // drag ë°˜ëŒ€ë°©í–¥ìœ¼ë¡œ ë°œì‚¬
    let vx = -dx * 6.5;
    let vy = -dy * 6.5;

    const speed = Math.min(2200, Math.hypot(vx, vy));
    const angle = Math.atan2(vy, vx);

    const pr = shooter.projectile;
    const finalSpeed = speed * pr.powerMul;
    vx = Math.cos(angle) * finalSpeed;
    vy = Math.sin(angle) * finalSpeed * pr.arcMul;

    // ê¸°ë³¸ ë°©í–¥ ë³´ì •
    if (shooter.id === 'seo' && vx < 0) vx *= 0.65;
    if (shooter.id === 'jokbal' && vx > 0) vx *= 0.65;

    shots.push(new Shot(turn, sp.x, sp.y, vx, vy));
    shotInAir = true;
  }

  canvas.addEventListener('pointerdown', (e) => {
    e.preventDefault();
    if (!running) return;
    if (turnTransitioning) return;
    if (shotInAir) return;

    const m = getPointerPos(e);
    if (!canGrabAmmo(m, turn)) return;

    dragging = true;
    dragStart = m;
    dragNow = m;

    canvas.setPointerCapture(e.pointerId);
  });

  canvas.addEventListener('pointermove', (e) => {
    e.preventDefault();
    if (!dragging) return;
    dragNow = getPointerPos(e);
  });

  canvas.addEventListener('pointerup', (e) => {
    e.preventDefault();
    if (!dragging) return;
    dragging = false;

    if (!running) return;
    if (turnTransitioning) return;
    if (shotInAir) return;

    fireShotFromDrag();
  });

  // ===== Buttons =====
  startSeo.onclick = () => {
    reset();
    turn = 0; // ì„œì¸ì¬ ì„ ê³µ
    running = true;
    toast("ê²Œì„ ì‹œì‘! ì„œì¸ì¬ ì„ ê³µ");
    beginTurn();
  };

  startJokbal.onclick = () => {
    reset();
    turn = 1; // ì•ˆì¡±ë°œ ì„ ê³µ
    running = true;
    toast("ê²Œì„ ì‹œì‘! ì•ˆì¡±ë°œ ì„ ê³µ");
    beginTurn();
  };

  resetBtn.onclick = () => reset();

  function reset(){
    running = false;
    shots = [];
    players[0].hp = 100;
    players[1].hp = 100;
    players[0].x = 160;
    players[1].x = 740;

    wind = 0;
    windEl.textContent = "0";
    turnEl.textContent = "-";
    timerEl.textContent = "--";

    shotInAir = false;
    turnTransitioning = false;
    dragging = false;

    errEl.style.display = 'none';
    errEl.textContent = "";

    toast("ì„ ê³µ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•´!");
  }

  function toast(t){ msgEl.textContent = "ğŸ’¬ " + t; }

  // ===== Drawing =====
  function drawKitchen() {
    // wall base
    ctx.fillStyle = "rgba(255,255,255,0.03)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // ceiling light
    ctx.fillStyle = "rgba(255,255,255,0.06)";
    ctx.beginPath();
    ctx.ellipse(canvas.width/2, 55, 165, 55, 0, 0, Math.PI*2);
    ctx.fill();

    // upper cabinets
    ctx.fillStyle = "rgba(255,255,255,0.07)";
    ctx.fillRect(520, 105, 340, 80);
    ctx.strokeStyle = "rgba(255,255,255,0.10)";
    ctx.strokeRect(520, 105, 340, 80);
    ctx.beginPath(); ctx.moveTo(690,105); ctx.lineTo(690,185); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(780,105); ctx.lineTo(780,185); ctx.stroke();

    // fridge left
    ctx.fillStyle = "rgba(255,255,255,0.09)";
    ctx.fillRect(70, 120, 130, 255);
    ctx.fillStyle = "rgba(255,255,255,0.12)";
    ctx.fillRect(70, 120, 130, 44);
    ctx.fillStyle = "rgba(255,255,255,0.18)";
    ctx.fillRect(188, 186, 6, 78);
    ctx.fillRect(188, 280, 6, 70);

    // sink/counter
    ctx.fillStyle = "rgba(255,255,255,0.06)";
    ctx.fillRect(520, 290, 350, 105);
    ctx.fillStyle = "rgba(255,255,255,0.10)";
    ctx.fillRect(520, 276, 350, 16);

    // sink bowl
    ctx.fillStyle = "rgba(2,6,23,0.35)";
    ctx.fillRect(600, 312, 130, 60);
    ctx.strokeStyle = "rgba(255,255,255,0.10)";
    ctx.strokeRect(600, 312, 130, 60);

    // utensils dots
    ctx.fillStyle = "rgba(255,255,255,0.10)";
    for (let i=0;i<9;i++){
      ctx.beginPath();
      ctx.arc(760 + i*10, 310 + (i%3)*8, 2.2, 0, Math.PI*2);
      ctx.fill();
    }

    // floor tiles
    ctx.fillStyle = "rgba(255,255,255,0.05)";
    ctx.fillRect(LEFT, GROUND_Y, canvas.width - LEFT*2, 70);
    ctx.strokeStyle = "rgba(255,255,255,0.05)";
    ctx.lineWidth = 1;
    for (let x=LEFT; x<RIGHT; x+=40){
      ctx.beginPath();
      ctx.moveTo(x, GROUND_Y);
      ctx.lineTo(x, GROUND_Y+70);
      ctx.stroke();
    }

    // label
    ctx.fillStyle = "rgba(255,255,255,0.10)";
    ctx.font = "14px system-ui";
    ctx.fillText("ì£¼ë°© ê²°íˆ¬ì¥", 42, 92);

    // ground line
    ctx.fillStyle = "rgba(255,255,255,0.08)";
    ctx.fillRect(LEFT, GROUND_Y, canvas.width - LEFT*2, 8);
  }

  function drawHPBar(pl, x, y) {
    const w = 260, h = 14;
    ctx.fillStyle = "rgba(0,0,0,0.35)";
    ctx.fillRect(x, y, w, h);
    ctx.fillStyle = "rgba(239,68,68,0.82)";
    ctx.fillRect(x, y, w * (pl.hp/100), h);
    ctx.strokeStyle = "rgba(255,255,255,0.18)";
    ctx.strokeRect(x, y, w, h);
    ctx.fillStyle = "rgba(255,255,255,0.75)";
    ctx.font = "13px system-ui";
    ctx.fillText(`${pl.name} HP ${pl.hp}`, x, y - 6);
  }

  function drawWindGauge() {
    ctx.fillStyle = "rgba(255,255,255,0.18)";
    ctx.font = "14px system-ui";
    ctx.fillText("ë°”ëŒ", canvas.width/2 - 18, 26);

    ctx.strokeStyle = "rgba(255,255,255,0.14)";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(canvas.width/2 - 90, 40);
    ctx.lineTo(canvas.width/2 + 90, 40);
    ctx.stroke();

    const wNorm = Math.max(-1, Math.min(1, wind / BASE_WIND));
    ctx.strokeStyle = "rgba(59,130,246,0.55)";
    ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.moveTo(canvas.width/2, 40);
    ctx.lineTo(canvas.width/2 + wNorm * 90, 40);
    ctx.stroke();
  }

  function drawPlayer(pl) {
    const x = pl.x, y = pl.y;
    ctx.save();
    ctx.translate(x, y);

    // shadow
    ctx.fillStyle = "rgba(0,0,0,0.25)";
    ctx.beginPath();
    ctx.ellipse(0, 6, pl.body.w*0.58, 10, 0, 0, Math.PI*2);
    ctx.fill();

    // body
    ctx.fillStyle = "rgba(255,255,255,0.18)";
    ctx.beginPath();
    ctx.ellipse(0, -pl.body.h/2, pl.body.w/2, pl.body.h/2, 0, 0, Math.PI*2);
    ctx.fill();

    // head
    const headY = -pl.body.h - pl.head.r + 10;
    ctx.beginPath();
    ctx.arc(0, headY, pl.head.r, 0, Math.PI*2);
    ctx.fill();

    // arm
    const dir = (pl.id === 'seo') ? 1 : -1;
    ctx.fillStyle = "rgba(255,255,255,0.18)";
    ctx.fillRect(dir*(pl.body.w/2 - 4), -pl.body.h*0.78, dir*46, 10);

    // face / details
    if (pl.id === 'seo') {
      // ê³¨ë ˜ìŠ¤í†¤: ë¬´í‘œì • + ëŒë¬´ëŠ¬ + ì•½ê°„ì˜ "ê°ì§„ ëŠë‚Œ"
      ctx.fillStyle = "rgba(2,6,23,0.55)";
      ctx.beginPath(); ctx.arc(-6, headY-2, 2.2, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc( 6, headY-2, 2.2, 0, Math.PI*2); ctx.fill();
      ctx.fillRect(-8, headY+8, 16, 2);

      // ë¨¸ë¦¬ ìœ„ ëŒê°
      ctx.fillStyle = "rgba(255,255,255,0.10)";
      ctx.fillRect(-12, headY-18, 24, 6);

      // ëª¸ ëŒë¬´ëŠ¬
      ctx.fillStyle = "rgba(255,255,255,0.10)";
      for (let i=0;i<8;i++){
        ctx.fillRect(-pl.body.w/2 + 6 + i*10, -pl.body.h + 18 + (i%2)*16, 8, 10);
      }
    } else {
      // ë§ˆì™•ëš±ë³´: ëŒ€ë¨¸ë¦¬ ë°˜ì§ + ì•ˆê²½ + ì™•ê´€/ë¿” ëŠë‚Œ
      // ë¿”(ì™•ê´€ ëŠë‚Œ)
      ctx.fillStyle = "rgba(245,158,11,0.25)";
      ctx.beginPath();
      ctx.moveTo(-14, headY-18);
      ctx.lineTo(-4, headY-30);
      ctx.lineTo(0, headY-18);
      ctx.lineTo(4, headY-30);
      ctx.lineTo(14, headY-18);
      ctx.closePath();
      ctx.fill();

      // ëŒ€ë¨¸ë¦¬ í•˜ì´ë¼ì´íŠ¸
      ctx.fillStyle = "rgba(255,255,255,0.12)";
      ctx.beginPath();
      ctx.arc(0, headY-6, 7, 0, Math.PI*2);
      ctx.fill();

      // ì•ˆê²½
      ctx.strokeStyle = "rgba(2,6,23,0.35)";
      ctx.lineWidth = 2.5;
      ctx.beginPath(); ctx.arc(-8, headY, 9, 0, Math.PI*2); ctx.stroke();
      ctx.beginPath(); ctx.arc( 8, headY, 9, 0, Math.PI*2); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(-1, headY); ctx.lineTo(1, headY); ctx.stroke();

      // ëˆˆ/ì°¡ê·¸ë¦° ì…
      ctx.fillStyle = "rgba(2,6,23,0.55)";
      ctx.beginPath(); ctx.arc(-7, headY+1, 2.4, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc( 7, headY+1, 2.4, 0, Math.PI*2); ctx.fill();
      ctx.beginPath();
      ctx.arc(0, headY+12, 7, 0.15*Math.PI, 0.85*Math.PI);
      ctx.strokeStyle = "rgba(2,6,23,0.55)";
      ctx.lineWidth = 2;
      ctx.stroke();

      // ë§ˆì™• ì˜¤ë¼(ëª¸ ì£¼ë³€)
      ctx.strokeStyle = "rgba(245,158,11,0.14)";
      ctx.lineWidth = 10;
      ctx.beginPath();
      ctx.ellipse(0, -pl.body.h/2, pl.body.w/2 + 8, pl.body.h/2 + 8, 0, 0, Math.PI*2);
      ctx.stroke();
    }

    // name
    ctx.fillStyle = "rgba(255,255,255,0.72)";
    ctx.font = "14px system-ui";
    ctx.fillText(pl.name, -26, 32);

    ctx.restore();
  }

  function drawAmmoReady() {
    if (!running) return;
    if (shotInAir) return;

    const pl = players[turn];
    const sp = spawnPosFor(pl);

    ctx.save();
    ctx.translate(sp.x, sp.y);

    if (pl.projectile.kind === 'jokbal') {
      ctx.beginPath();
      ctx.arc(0,0,pl.projectile.r,0,Math.PI*2);
      ctx.fillStyle="rgba(236,179,95,0.96)"; ctx.fill();
      ctx.strokeStyle="rgba(255,255,255,0.90)";
      ctx.lineWidth=3;
      ctx.beginPath(); ctx.moveTo(-6,-2); ctx.lineTo(10,7); ctx.stroke();
      ctx.strokeStyle = "rgba(245,158,11,0.35)";
      ctx.lineWidth = 6;
      ctx.beginPath(); ctx.arc(0,0,pl.projectile.r+6,0,Math.PI*2); ctx.stroke();
    } else {
      ctx.beginPath();
      ctx.arc(0,0,pl.projectile.r,0,Math.PI*2);
      ctx.fillStyle="rgba(147,197,253,0.96)"; ctx.fill();
      ctx.fillStyle="rgba(2,6,23,0.75)";
      ctx.beginPath(); ctx.arc(4,-3,2.2,0,Math.PI*2); ctx.fill();
      ctx.strokeStyle="rgba(2,6,23,0.32)";
      ctx.lineWidth=3;
      ctx.beginPath();
      ctx.moveTo(-pl.projectile.r,0); ctx.lineTo(- kindsafe(pl.projectile.r)-8,-6);
      ctx.moveTo(-pl.projectile.r,0); ctx.lineTo(- kindsafe(pl.projectile.r)-8, 6);
      ctx.stroke();
    }
    ctx.restore();

    function kindsafe(r){ return r; }
  }

  function drawDragLine() {
    if (!dragging) return;

    const pl = players[turn];
    const sp = spawnPosFor(pl);

    ctx.strokeStyle = "rgba(59,130,246,0.65)";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(sp.x, sp.y);
    ctx.lineTo(dragNow.x, dragNow.y);
    ctx.stroke();

    const dx = dragNow.x - dragStart.x;
    const dy = dragNow.y - dragStart.y;
    const strength = Math.min(120, Math.hypot(dx,dy));
    ctx.fillStyle = "rgba(255,255,255,0.78)";
    ctx.font = "16px system-ui";
    ctx.fillText("í˜: " + Math.round(strength), sp.x - 10, sp.y - 22);
  }

  // ===== Main loop =====
  function loop(now) {
    const dt = Math.min(0.033, (now - last)/1000);
    last = now;

    if (running) {
      turnTimeLeft -= dt;
      timerEl.textContent = turnTimeLeft.toFixed(0) + "s";

      if (turnTimeLeft <= 0 && !shotInAir && !turnTransitioning) {
        endTurn("ì‹œê°„ ì´ˆê³¼! í„´ ë„˜ì–´ê°");
      }
    }

    for (const s of shots) s.update(dt);
    shots = shots.filter(s => !s.dead);

    // Render
    ctx.clearRect(0,0,canvas.width,canvas.height);

    drawKitchen();
    drawHPBar(players[0], 40, 18);
    drawHPBar(players[1], canvas.width - 300, 18);
    drawWindGauge();

    drawPlayer(players[0]);
    drawPlayer(players[1]);

    drawAmmoReady();
    drawDragLine();

    for (const s of shots) s.draw();

    requestAnimationFrame(loop);
  }

  // Start loop
  requestAnimationFrame(loop);

  // ì´ˆê¸°í™”
  reset();

})();
</script>
</body>
</html>

